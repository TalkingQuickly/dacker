rails_app:
  build: .
  ports:
   - "3000:3000"
  environment:
   - RAILS_ENV=development
  volumes:
   - /vagrant:/app
  deploy:
   name: web1
   signal: SIGTERM
   container:
    - delete
    - build
    - create
    - start
   order: 2
   host: 192.168.50.60
   user: vagrant
   password: vagrant

load_balancer:
  image: nginx
  volumes:
   - /home/vagrant/vhosts:/etc/nginx/conf.d
  ports:
   - "80:80"
  deploy:
   name: lb1
   files:
    - /home/vagrant/vhosts/test_app.conf:dacker/templates/vhost
   signal: HUP
   order: 1
   host: 192.168.50.60
   user: vagrant
   password: vagrant

database:
  image: postgres
  volumes:
   - /home/vagrant/pg_data:/var/lib/postgresql/data
  ports:
   - 5432:5432
  deploy:
   name: pg1
   order: 0
   host: 192.168.50.60
   user: vagrant
   password: vagrant
